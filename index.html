<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Urban Heat Island – Kraków</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, Arial, sans-serif; }
    header { padding: 10px 14px; border-bottom: 1px solid #eee; }
    #map { height: calc(100vh - 54px); }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    select { padding: 6px; }
  </style>
</head>
<body>
  <header>
    <div class="row">
      <strong>Urban Heat Island – Kraków</strong>
      <label>
        Data:
        <select id="dateSelect">
          <option value="2025-07-01">2025-07-01</option>
        </select>
      </label>
      <span id="stats"></span>
    </div>
  </header>

  <div id="map"></div>

  <script>
    // 1) mapa
    const map = L.map('map').setView([50.0647, 19.9450], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    let layer;

    function colorForTemp(t) {
      // prosty podział - możesz zmienić
      if (t >= 45) return 'red';
      if (t >= 40) return 'orange';
      if (t >= 35) return 'gold';
      return 'blue';
    }

    async function loadHotspots(date) {
      // 2) wczytaj geojson z pliku (na start)
      const url = `data/hotspots_${date}.geojson`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Nie mogę wczytać: ${url}`);
      const geojson = await res.json();

      // usuń poprzednią warstwę
      if (layer) layer.remove();

      // dodaj punkty
      layer = L.geoJSON(geojson, {
        pointToLayer: (feature, latlng) => {
          const t = feature.properties.temp;
          return L.circleMarker(latlng, {
            radius: 6,
            weight: 1,
            fillOpacity: 0.7,
            color: colorForTemp(t)
          });
        },
        onEachFeature: (feature, l) => {
          const p = feature.properties;
          l.bindPopup(`<b>Temp:</b> ${p.temp}°C<br><b>Data:</b> ${p.date}`);
        }
      }).addTo(map);

      // 3) staty (proste)
      const temps = geojson.features.map(f => f.properties.temp);
      const min = Math.min(...temps);
      const max = Math.max(...temps);
      const avg = temps.reduce((a,b)=>a+b,0) / temps.length;
      document.getElementById('stats').textContent =
        `min: ${min.toFixed(1)}°C | avg: ${avg.toFixed(1)}°C | max: ${max.toFixed(1)}°C`;
    }

    // obsługa selecta
    const dateSelect = document.getElementById('dateSelect');
    dateSelect.addEventListener('change', () => loadHotspots(dateSelect.value));

    // start
    loadHotspots(dateSelect.value).catch(err => alert(err.message));
  </script>
</body>
</html>
